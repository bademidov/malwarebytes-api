#!/usr/bin/env zsh
echo -n 'Enter client_id: '
read CLIENT_ID
echo -n 'Enter client_secret: '
read CLIENT_SECRET


BASE64_STRING=$(echo -n "$CLIENT_ID:$CLIENT_SECRET" | base64)
echo " "
echo "Base64 encoded credential pair:"
echo $BASE64_STRING
echo " "

TOKEN=$(curl --silent --location --request POST "https://api.malwarebytes.com/oauth2/token" \
--header "Content-Type: application/x-www-form-urlencoded" \
--header "Authorization: Basic $BASE64_STRING" \
--header "Content-Type: application/x-www-form-urlencoded" \
--data-urlencode "grant_type=client_credentials" \
--data-urlencode "scope=read" \
| sed -n -e 's/^.*access_token":"//p' | cut -d'"' -f1)

echo "Access Token (expires in 1 hour):"
echo $TOKEN


if [[ ! -z $TOKEN ]]; then
    echo " "
    echo "Authentication is successful."
    echo "Credentials are valid!";
else
    echo "Authentication failed."
    echo "Please check you credentials or network connectivity and try again."
fi
